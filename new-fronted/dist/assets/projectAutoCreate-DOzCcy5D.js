import{r as p,p as n}from"./index-yu4waMHZ.js";import{f as a,s as d}from"./scenes-4ITdBoBR.js";function R(e){const t=p.useRef({value:e,previous:e});return p.useMemo(()=>(t.current.value!==e&&(t.current.previous=t.current.value,t.current.value=e),t.current.previous),[e])}const P={async createTemporaryProject(e){const s=(await n.createTempProject()).data,r={title:"第一集",summary:e?.scriptText?e.scriptText.substring(0,100)+"...":""},c=(await a.createEpisode(s.id,r)).data;let i;if(e?.scriptText||e?.novelContent){await a.updateEpisode(s.id,c.episodeId,{scriptText:e.scriptText||e.novelContent});const u={location:"场景1",description:"默认场景",createMasterNode:!0,masterPositionX:100,masterPositionY:100};i=(await d.createScene(c.episodeId,u)).data}return{project:s,episode:c,scene:i}},async convertToFormalProject(e,t){await n.saveTempProject(e,{name:t})},async recoverTemporaryProject(){try{const s=((await n.listProjects(1,10)).data||[]).find(c=>c.is_active===!1);if(!s)return null;const o=(await a.listEpisodes(s.id)).data||[];return o.length===0?null:{project:s,episode:o[0]}}catch(e){return console.error("恢复临时项目失败:",e),null}},async createEmptyProject(e){const s=(await n.createProject({name:e})).data,o=(await a.createEpisode(s.id,{title:"第一集",summary:""})).data,i=(await d.createScene(o.episodeId,{location:"场景1",description:"",createMasterNode:!0,masterPositionX:100,masterPositionY:100})).data;return{project:s,episode:o,scene:i}},async hasContent(e,t){try{const r=(await a.getEpisode(e,t)).data;return!!(r.scriptText&&r.scriptText.length>0)}catch{return!1}}};export{P as p,R as u};
