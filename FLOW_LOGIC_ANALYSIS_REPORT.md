# æ•…äº‹ç­–åˆ’ç³»ç»Ÿä¼˜åŒ– - æµç¨‹é€»è¾‘å…¨é¢åˆ†ææŠ¥å‘Š

## æ‰§è¡Œæ—¥æœŸ
2026-02-10

## ä¸€ã€æ•´ä½“æ¶æ„æµç¨‹å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Story Planner Agent å®Œæ•´æµç¨‹                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[ç”¨æˆ·è¯·æ±‚]
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ create_story_planner_agent()                                   [story_planner.py:356]
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â”œâ”€â”€ 1. è·å–å¸‚åœºåˆ†ææŠ¥å‘Š â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   â”‚                                                                       â”‚
    â”‚   â”œâ”€â”€ get_market_analysis_service()                                       â”‚
    â”‚   â”‚   â””â”€â”€ get_latest_analysis()                                           â”‚
    â”‚   â”‚       â”œâ”€â”€ æŸ¥è¯¢æ•°æ®åº“ market_reports è¡¨                                 â”‚
    â”‚   â”‚       â”‚   â””â”€â”€ æ£€æŸ¥ valid_until æ˜¯å¦è¿‡æœŸ                               â”‚
    â”‚   â”‚       â”‚                                                               â”‚
    â”‚   â”‚       â””â”€â”€ è¿”å›ç»“æ„:                                                   â”‚
    â”‚   â”‚           {                                                           â”‚
    â”‚   â”‚             "genres": [...],          # çƒ­é—¨é¢˜æè¶‹åŠ¿                   â”‚
    â”‚   â”‚             "tones": [...],           # æ¨èè°ƒæ€§                      â”‚
    â”‚   â”‚             "insights": "...",        # å¸‚åœºæ´å¯Ÿ                      â”‚
    â”‚   â”‚             "audience": "...",        # ç›®æ ‡å—ä¼—                      â”‚
    â”‚   â”‚             "hot_elements": {          # âœ… æ–°å¢ï¼šçƒ­ç‚¹å…ƒç´              â”‚
    â”‚   â”‚               "hot_tropes": [...],     # çƒ­é—¨å…ƒç´                      â”‚
    â”‚   â”‚               "hot_settings": [...],   # çƒ­é—¨èƒŒæ™¯                     â”‚
    â”‚   â”‚               "hot_character_types": [...], # çƒ­é—¨äººè®¾                â”‚
    â”‚   â”‚               "emerging_combinations": [...], # æ–°å…´ç»„åˆ             â”‚
    â”‚   â”‚               "overused_tropes": [...],      # è¿‡åº¦ä½¿ç”¨å¥—è·¯          â”‚
    â”‚   â”‚               "specific_works": [...]         # å‚è€ƒçˆ†æ¬¾å‰§           â”‚
    â”‚   â”‚             },                                                        â”‚
    â”‚   â”‚             "analyzed_at": "...",                                     â”‚
    â”‚   â”‚             "valid_until": "..."                                      â”‚
    â”‚   â”‚           }                                                           â”‚
    â”‚   â”‚                                                                       â”‚
    â”‚   â””â”€â”€ [å¦‚æœæ²¡æœ‰ç¼“å­˜]                                                      â”‚
    â”‚       â””â”€â”€ è¿”å›é”™è¯¯æç¤ºç»™ç”¨æˆ·                                               â”‚
    â”‚                                                                           â”‚
    â”œâ”€â”€ 2. è·å–å»é‡ä¸Šä¸‹æ–‡ï¼ˆä»…é‡æ–°ç”Ÿæˆæ—¶ï¼‰â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   â”‚                                                                       â”‚
    â”‚   â””â”€â”€ if is_regenerate:                                                   â”‚
    â”‚       â””â”€â”€ get_dedup_service()                                             â”‚
    â”‚           â””â”€â”€ get_dedup_context_for_prompt(user_id, days=7)               â”‚
    â”‚               â”œâ”€â”€ _get_recent_plans(user_id, days=7)                      â”‚
    â”‚               â”‚   â””â”€â”€ db.get_recent_plans()                               â”‚
    â”‚               â”‚       â””â”€â”€ æŸ¥è¯¢ generated_plans_history è¡¨                  â”‚
    â”‚               â”‚           â””â”€â”€ SELECT * WHERE user_id = ?                   â”‚
    â”‚               â”‚               AND generated_at > NOW() - 7 days            â”‚
    â”‚               â”‚                                                               â”‚
    â”‚               â””â”€â”€ ç”Ÿæˆå»é‡æç¤ºæ–‡æœ¬:                                        â”‚
    â”‚                   "## ğŸš« å»é‡æé†’                                          â”‚
    â”‚                    æ ¹æ®æ‚¨æœ€è¿‘ç”Ÿæˆçš„æ–¹æ¡ˆï¼Œä»¥ä¸‹å…ƒç´ å·²è¢«ä½¿ç”¨è¿‡ï¼š               â”‚
    â”‚                    - å·²ä½¿ç”¨å…ƒç´ ï¼šxxx, xxx...                                â”‚
    â”‚                    - å·²ä½¿ç”¨ç»„åˆï¼šxxx + xxx                                  â”‚
    â”‚                    ### å¼ºåˆ¶å»é‡è§„åˆ™..."                                     â”‚
    â”‚                                                                           â”‚
    â”œâ”€â”€ 3. åŠ è½½åŸºç¡€Prompt â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   â”‚                                                                       â”‚
    â”‚   â””â”€â”€ _load_story_planner_prompt()                                        â”‚
    â”‚       â”œâ”€â”€ è¯»å–æ–‡ä»¶ prompts/2_Story_Planner.md                              â”‚
    â”‚       â”‚                                                                   â”‚
    â”‚       â”œâ”€â”€ æ³¨å…¥å¸‚åœºæŠ¥å‘Š (_format_market_report)                            â”‚
    â”‚       â”‚   â”œâ”€â”€ çƒ­é—¨å…ƒç´  (hot_tropes)                                        â”‚
    â”‚       â”‚   â”œâ”€â”€ çƒ­é—¨èƒŒæ™¯ (hot_settings)                                      â”‚
    â”‚       â”‚   â”œâ”€â”€ çƒ­é—¨äººè®¾ (hot_character_types)                               â”‚
    â”‚       â”‚   â”œâ”€â”€ æ–°å…´ç»„åˆ (emerging_combinations) âœ… å…³é”®åˆ›æ–°ç‚¹               â”‚
    â”‚       â”‚   â”œâ”€â”€ è¿‡åº¦ä½¿ç”¨å¥—è·¯ (overused_tropes) âœ… é¿å…é‡å¤                   â”‚
    â”‚       â”‚   â”œâ”€â”€ å‚è€ƒçˆ†æ¬¾å‰§ (specific_works)                                  â”‚
    â”‚       â”‚   â””â”€â”€ åˆ›æ„å»ºè®®ï¼ˆè½¯æ€§å¼•å¯¼ï¼‰                                         â”‚
    â”‚       â”‚                                                                   â”‚
    â”‚       â”œâ”€â”€ æ³¨å…¥ä¸»é¢˜åº“æ•°æ® â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
    â”‚       â”‚   â”‚                                                              â”‚  â”‚
    â”‚       â”‚   â”œâ”€â”€ _get_all_theme_slugs()                                     â”‚  â”‚
    â”‚       â”‚   â”‚   â””â”€â”€ db.get_all_themes()                                    â”‚  â”‚
    â”‚       â”‚   â”‚       â””â”€â”€ SELECT slug FROM themes                            â”‚  â”‚
    â”‚       â”‚   â”‚           WHERE is_active = true                             â”‚  â”‚
    â”‚       â”‚   â”‚           ORDER BY market_score DESC                         â”‚  â”‚
    â”‚       â”‚   â”‚           è¿”å›: ["revenge", "transmigration", ...] 13ä¸ª      â”‚  â”‚
    â”‚       â”‚   â”‚                                                              â”‚  â”‚
    â”‚       â”‚   â”œâ”€â”€ éšæœºé€‰æ‹© 5-8 ä¸ªä¸»é¢˜                                        â”‚  â”‚
    â”‚       â”‚   â”‚   â””â”€â”€ random.sample(all_slugs, k=random.randint(5,8))        â”‚  â”‚
    â”‚       â”‚   â”‚                                                              â”‚  â”‚
    â”‚       â”‚   â”œâ”€â”€ åŠ è½½é€‰ä¸­ä¸»é¢˜è¯¦ç»†æ•°æ®                                       â”‚  â”‚
    â”‚       â”‚   â”‚   â””â”€â”€ for slug in selected_slugs:                            â”‚  â”‚
    â”‚       â”‚   â”‚       â””â”€â”€ load_genre_context.ainvoke({"genre_id": slug})     â”‚  â”‚
    â”‚       â”‚   â”‚           â””â”€â”€ æŸ¥è¯¢æ•°æ®åº“ themes è¡¨                           â”‚  â”‚
    â”‚       â”‚   â”‚               â””â”€â”€ è¿”å›å®Œæ•´ä¸»é¢˜æ•°æ®                           â”‚  â”‚
    â”‚       â”‚   â”‚                                                              â”‚  â”‚
    â”‚       â”‚   â””â”€â”€ æ„å»ºæç¤ºæ–‡æœ¬:                                              â”‚  â”‚
    â”‚       â”‚       "## ğŸ“š é¢˜æåº“ä¿¡æ¯                                          â”‚  â”‚
    â”‚       â”‚        ### å…¨éƒ¨å¯ç”¨é¢˜æï¼ˆ13ä¸ªï¼‰                                   â”‚  â”‚
    â”‚       â”‚        revenge, romance, suspense, transmigration...            â”‚  â”‚
    â”‚       â”‚                                                                   â”‚  â”‚
    â”‚       â”‚        ### è¯¦ç»†åŠ è½½çš„é¢˜æï¼ˆ5-8ä¸ªï¼‰                                â”‚  â”‚
    â”‚       â”‚        ä»¥ä¸‹é¢˜æçš„å®Œæ•´ä¿¡æ¯å·²åŠ è½½...                                â”‚  â”‚
    â”‚       â”‚                                                                   â”‚  â”‚
    â”‚       â”‚        ### é¢˜æé€‰æ‹©å»ºè®®                                           â”‚  â”‚
    â”‚       â”‚        1. çƒ­é—¨é¢˜æï¼ˆmarket_score > 85ï¼‰ï¼š...                       â”‚  â”‚
    â”‚       â”‚        2. æ–°å…´é¢˜æï¼ˆmarket_score 75-85ï¼‰ï¼š...                      â”‚  â”‚
    â”‚       â”‚        3. æ¨èç­–ç•¥ï¼šé€‰æ‹©1ä¸ªçƒ­é—¨ + 1ä¸ªæ–°å…´ + 1ä¸ªåˆ›æ–°å…ƒç´ "           â”‚  â”‚
    â”‚       â”‚                                                                   â”‚  â”‚
    â”‚       â”œâ”€â”€ æ³¨å…¥æ¨èå…ƒç´  (tropes) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
    â”‚       â”‚   â”œâ”€â”€ éšæœºé€‰æ‹©2-3ä¸ªä¸»é¢˜                                          â”‚  â”‚
    â”‚       â”‚   â””â”€â”€ for theme in selected_themes:                              â”‚  â”‚
    â”‚       â”‚       â””â”€â”€ get_tropes.ainvoke({"genre_id": theme, "limit": 3})    â”‚  â”‚
    â”‚       â”‚           â””â”€â”€ æŸ¥è¯¢æ•°æ®åº“ theme_elements è¡¨                        â”‚  â”‚
    â”‚       â”‚               â””â”€â”€ WHERE theme_id = ?                             â”‚  â”‚
    â”‚       â”‚                   ORDER BY effectiveness_score DESC              â”‚  â”‚
    â”‚       â”‚                                                                   â”‚  â”‚
    â”‚       â””â”€â”€ æ³¨å…¥å¸‚åœºè¶‹åŠ¿ (market_trends)                                   â”‚  â”‚
    â”‚           â””â”€â”€ get_market_trends.ainvoke({})                              â”‚  â”‚
    â”‚                                                                           â”‚
    â”œâ”€â”€ 4. ç»„è£…å®Œæ•´Prompt â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   â”‚                                                                       â”‚
    â”‚   â”œâ”€â”€ base_prompt = _load_story_planner_prompt(...)                       â”‚
    â”‚   â”œâ”€â”€ if dedup_context:                                                   â”‚
    â”‚   â”‚   â””â”€â”€ base_prompt += "\n\n" + dedup_context                            â”‚
    â”‚   â””â”€â”€ final_prompt = base_prompt                                          â”‚
    â”‚                                                                           â”‚
    â””â”€â”€ 5. åˆ›å»º Agent â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                                                                       â”‚
        â””â”€â”€ create_react_agent(                                                 â”‚
                model=model,                    # ä»model_routerè·å–çš„æ¨¡å‹     â”‚
                tools=[                                                         â”‚
                    load_genre_context,         # åŠ è½½é¢˜æä¸Šä¸‹æ–‡               â”‚
                    get_tropes,                 # è·å–æ¨èå…ƒç´                  â”‚
                    get_hooks,                  # è·å–é’©å­æ¨¡æ¿                 â”‚
                    get_character_archetypes,   # è·å–è§’è‰²åŸå‹                 â”‚
                    get_writing_keywords,       # è·å–å†™ä½œå…³é”®è¯               â”‚
                    get_sensory_guide,          # è·å–äº”æ„ŸæŒ‡å¯¼                 â”‚
                    get_pacing_rules,           # è·å–èŠ‚å¥è§„åˆ™                 â”‚
                    get_trending_combinations,  # è·å–çƒ­é—¨ç»„åˆ                 â”‚
                ],                                                              â”‚
                prompt=final_prompt,                                            â”‚
            )                                                                   â”‚
                                                                                â”‚
[è¿”å› create_story_planner_agent]                                               â”‚
    â”‚                                                                           â”‚
    â–¼                                                                           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                            â”‚
â”‚ Agent å¯ä»¥å¼€å§‹ç”Ÿæˆæ–¹æ¡ˆäº†                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                            â”‚
                                                                                â”‚
                                                                                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         å¸‚åœºåˆ†ææœåŠ¡ç‹¬ç«‹æµç¨‹                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                                                â”‚
[åå°å®šæ—¶ä»»åŠ¡ / æ‰‹åŠ¨è§¦å‘]                                                        â”‚
    â”‚                                                                           â”‚
    â–¼                                                                           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                            â”‚
â”‚ run_daily_analysis()                                            [market_analysis.py:106]
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                            â”‚
    â”‚                                                                           â”‚
    â”œâ”€â”€ 1. ç”Ÿæˆæœç´¢æŸ¥è¯¢ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚   â”‚                                                                       â”‚
    â”‚   â””â”€â”€ _get_search_queries()                                               â”‚
    â”‚       â”œâ”€â”€ åŸºç¡€æŸ¥è¯¢ï¼ˆ3ä¸ªï¼‰                                                  â”‚
    â”‚       â”‚   â””â”€â”€ "2026å¹´çŸ­å‰§çƒ­åº¦æ¦œ æŠ–éŸ³å¿«æ‰‹ æ—¥æ¦œ"                            â”‚
    â”‚       â”‚       "2026å¹´çŸ­å‰§æ’­æ”¾é‡æ’è¡Œ å¾®ä¿¡è§†é¢‘å·"                           â”‚
    â”‚       â”‚       "2026å¹´çŸ­å‰§çˆ†æ¬¾ å°çº¢ä¹¦æ¨è"                                 â”‚
    â”‚       â”‚                                                                   â”‚
    â”‚       â”œâ”€â”€ é¢˜æè¶‹åŠ¿æŸ¥è¯¢ï¼ˆéšæœºé€‰2ä¸ªï¼‰                                        â”‚
    â”‚       â”‚   â””â”€â”€ ä»7ä¸ªæŸ¥è¯¢ä¸­éšæœºé€‰æ‹©                                          â”‚
    â”‚       â”‚                                                                   â”‚
    â”‚       â”œâ”€â”€ ç¤¾ä¼šçƒ­ç‚¹æŸ¥è¯¢ï¼ˆéšæœºé€‰1ä¸ªï¼‰                                        â”‚
    â”‚       â”‚   â””â”€â”€ ä»5ä¸ªæŸ¥è¯¢ä¸­éšæœºé€‰æ‹©                                          â”‚
    â”‚       â”‚                                                                   â”‚
    â”‚       â””â”€â”€ ç«å“åˆ†ææŸ¥è¯¢ï¼ˆéšæœºé€‰1ä¸ªï¼‰                                        â”‚
    â”‚           â””â”€â”€ ä»5ä¸ªæŸ¥è¯¢ä¸­éšæœºé€‰æ‹©                                          â”‚
    â”‚               æ€»å…±: 3 + 2 + 1 + 1 = 7 ä¸ªæŸ¥è¯¢                               â”‚
    â”‚                                                                           â”‚
    â”œâ”€â”€ 2. æ‰§è¡Œæœç´¢ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚   â”‚                                                                       â”‚
    â”‚   â””â”€â”€ for query in search_queries:                                        â”‚
    â”‚       â””â”€â”€ metaso_search(query)                                            â”‚
    â”‚           â””â”€â”€ è°ƒç”¨å¤–éƒ¨æœç´¢API                                              â”‚
    â”‚               â””â”€â”€ è¿”å›æœç´¢ç»“æœæ–‡æœ¬                                         â”‚
    â”‚                                                                           â”‚
    â”œâ”€â”€ 3. æå–çƒ­ç‚¹å…ƒç´  âœ… å…³é”®åˆ›æ–° â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚   â”‚                                                                       â”‚
    â”‚   â””â”€â”€ _extract_hot_elements(search_results)                               â”‚
    â”‚       â”œâ”€â”€ æ„å»ºæœç´¢ä¸Šä¸‹æ–‡ (æ¯ä¸ªç»“æœå–3000å­—ç¬¦)                              â”‚
    â”‚       â”‚                                                                   â”‚
    â”‚       â”œâ”€â”€ è°ƒç”¨LLMåˆ†æ                                                      â”‚
    â”‚       â”‚   â””â”€â”€ æç¤ºè¯è¦æ±‚æå–:                                              â”‚
    â”‚       â”‚       - hot_tropes: çƒ­é—¨å…ƒç´                                        â”‚
    â”‚       â”‚       - hot_settings: çƒ­é—¨èƒŒæ™¯                                     â”‚
    â”‚       â”‚       - hot_character_types: çƒ­é—¨äººè®¾                              â”‚
    â”‚       â”‚       - emerging_combinations: æ–°å…´ç»„åˆ âœ…                         â”‚
    â”‚       â”‚       - overused_tropes: è¿‡åº¦ä½¿ç”¨å¥—è·¯ âœ…                           â”‚
    â”‚       â”‚       - specific_works: å‚è€ƒçˆ†æ¬¾å‰§                                 â”‚
    â”‚       â”‚                                                                   â”‚
    â”‚       â””â”€â”€ è§£æJSONè¿”å›                                                    â”‚
    â”‚           â””â”€â”€ è¿”å›ç»“æ„åŒ–çš„çƒ­ç‚¹å…ƒç´ æ•°æ®                                     â”‚
    â”‚                                                                           â”‚
    â”œâ”€â”€ 4. LLMæ·±åº¦åˆ†æ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚   â”‚                                                                       â”‚
    â”‚   â””â”€â”€ _analyze_with_llm(search_results, hot_elements)                     â”‚
    â”‚       â”œâ”€â”€ æ„å»ºå®Œæ•´ä¸Šä¸‹æ–‡                                                   â”‚
    â”‚       â”œâ”€â”€ æ³¨å…¥çƒ­ç‚¹å…ƒç´ åˆ°æç¤ºè¯                                             â”‚
    â”‚       â”œâ”€â”€ è°ƒç”¨LLMç”Ÿæˆå¸‚åœºåˆ†ææŠ¥å‘Š                                          â”‚
    â”‚       â””â”€â”€ è§£æJSONè¿”å›                                                     â”‚
    â”‚           {                                                               â”‚
    â”‚             "genres": [...],                                              â”‚
    â”‚             "tones": [...],                                               â”‚
    â”‚             "insights": "...",                                            â”‚
    â”‚             "audience": "..."                                             â”‚
    â”‚           }                                                               â”‚
    â”‚                                                                           â”‚
    â”œâ”€â”€ 5. ä¿å­˜åˆ†æç»“æœ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚   â”‚                                                                       â”‚
    â”‚   â””â”€â”€ _save_analysis(analysis)                                            â”‚
    â”‚       â”œâ”€â”€ æ„å»ºæ•°æ®å¯¹è±¡                                                     â”‚
    â”‚       â”‚   â”œâ”€â”€ report_type: "daily"                                        â”‚
    â”‚       â”‚   â”œâ”€â”€ genres: analysis["genres"]                                  â”‚
    â”‚       â”‚   â”œâ”€â”€ tones: analysis["tones"]                                    â”‚
    â”‚       â”‚   â”œâ”€â”€ insights: analysis["insights"]                              â”‚
    â”‚       â”‚   â”œâ”€â”€ target_audience: analysis["audience"]                       â”‚
    â”‚       â”‚   â”œâ”€â”€ hot_elements: analysis["hot_elements"] âœ…                   â”‚
    â”‚       â”‚   â”œâ”€â”€ valid_until: NOW() + 1 day  âœ… ç¼©çŸ­åˆ°1å¤©                     â”‚
    â”‚       â”‚   â””â”€â”€ is_active: true                                             â”‚
    â”‚       â”‚                                                                   â”‚
    â”‚       â””â”€â”€ db.create_market_report(data)                                   â”‚
    â”‚           â””â”€â”€ INSERT INTO market_reports                                  â”‚
    â”‚                                                                           â”‚
    â””â”€â”€ 6. è¿”å›åˆ†æç»“æœ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
    åˆ†æç»“æœå·²ä¿å­˜åˆ°æ•°æ®åº“
        â”‚
        â–¼
    Story Planner ä¸‹æ¬¡è°ƒç”¨æ—¶å³å¯ä½¿ç”¨


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         æ•°æ®åº“è¡¨ç»“æ„å…³ç³»                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      themes          â”‚         â”‚   theme_elements         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)              â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”¤ theme_id (FK)            â”‚
â”‚ slug (unique)        â”‚         â”‚ element_type             â”‚
â”‚ name                 â”‚         â”‚ name                     â”‚
â”‚ category             â”‚         â”‚ effectiveness_score      â”‚
â”‚ description          â”‚         â”‚ weight                   â”‚
â”‚ summary              â”‚         â”‚ usage_guidance (jsonb)   â”‚
â”‚ core_formula (jsonb) â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ keywords (jsonb)     â”‚
â”‚ audience_analysis    â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ market_score         â”‚         â”‚   theme_examples         â”‚
â”‚ success_rate         â”‚         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ is_active            â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”¤ theme_id (FK)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚ title                    â”‚
                                 â”‚ achievements (jsonb)     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚ is_verified              â”‚
â”‚   market_reports     â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)              â”‚
â”‚ report_type          â”‚
â”‚ genres (jsonb)       â”‚
â”‚ tones (jsonb)        â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ insights             â”‚         â”‚ generated_plans_history  â”‚ âœ… æ–°å¢
â”‚ hot_elements (jsonb) â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ valid_until          â”‚         â”‚ id (PK)                  â”‚
â”‚ is_active            â”‚         â”‚ user_id (FK)             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚ project_id (FK)          â”‚
                                 â”‚ plan_title               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚ core_tropes (jsonb)      â”‚
â”‚ user_plan_preferencesâ”‚ âœ… æ–°å¢ â”‚ genre_combination        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â—„â”€â”€â”€â”€â”€â”€â”€â”€â”¤ similarity_hash          â”‚
â”‚ id (PK)              â”‚         â”‚ embedding (vector)       â”‚
â”‚ user_id (FK)         â”‚         â”‚ generated_at             â”‚
â”‚ preferred_tropes     â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ avoided_tropes       â”‚
â”‚ regeneration_rate    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Promptå†…å®¹ç»“æ„åˆ†æ                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

System Prompt (2_Story_Planner.md) åŒ…å«ä»¥ä¸‹æ¨¡å—:

1. è§’è‰²å®šä¹‰
   â””â”€â”€ "ä½ æ˜¯ AI å…¨æµç¨‹çŸ­å‰§ç”Ÿæˆå¼•æ“ çš„ é¦–å¸­æ•…äº‹ç­–åˆ’å¸ˆ"

2. è¾“å…¥ä¸Šä¸‹æ–‡
   â”œâ”€â”€ åŠ¨æ€æ³¨å…¥çš„ä¸»é¢˜åº“æ•°æ®
   â”‚   â”œâ”€â”€ {theme_library_data}      â† å…¨éƒ¨13ä¸ªä¸»é¢˜åˆ—è¡¨ + è¯¦ç»†åŠ è½½5-8ä¸ª
   â”‚   â”œâ”€â”€ {recommended_tropes}      â† éšæœº2-3ä¸ªä¸»é¢˜çš„æ¨èå…ƒç´ 
   â”‚   â””â”€â”€ {market_trends}           â† å¸‚åœºè¶‹åŠ¿æ¦‚è§ˆ
   â”‚
   â”œâ”€â”€ ç”¨æˆ·è¾“å…¥
   â”‚   â”œâ”€â”€ {market_report}           â† âœ… å¢å¼ºï¼šåŒ…å«çƒ­ç‚¹å…ƒç´ å’Œåˆ›æ„å»ºè®®
   â”‚   â”œâ”€â”€ {episode_count}           â† 80
   â”‚   â”œâ”€â”€ {episode_duration}        â† 1.5
   â”‚   â”œâ”€â”€ {genre}                   â† ç”¨æˆ·é€‰æ‹©çš„èƒŒæ™¯
   â”‚   â””â”€â”€ {setting}                 â† modern/ancientç­‰
   â”‚
   â””â”€â”€ èåˆè¯·æ±‚ï¼ˆå¦‚æœæœ‰ï¼‰
       â””â”€â”€ {fusion_request}

3. ğŸ¨ è·¨é¢˜æèåˆåˆ›æ–°æŒ‡å— âœ… æ–°å¢
   â”œâ”€â”€ åˆ›æ–°åŸåˆ™ï¼ˆåå·®å¼ åŠ›ã€å…ƒç´ å€Ÿç”¨ã€è§†è§’è½¬æ¢ï¼‰
   â”œâ”€â”€ ğŸš« ç¦æ­¢ä½¿ç”¨çš„ç»„åˆï¼ˆå·²è¿‡åº¦ä½¿ç”¨ï¼‰
   â””â”€â”€ âœ… é¼“åŠ±å°è¯•çš„ç»„åˆï¼ˆ8ä¸ªåˆ›æ–°æ–¹å‘ï¼‰

4. âš ï¸ æ•°æ®åè§è­¦å‘Š âœ… æ–°å¢
   â””â”€â”€ æé†’é™ä½é“¶å‘/ç©¿è¶Š/é‡ç”Ÿæ¦‚ç‡

5. ğŸ¯ å¼ºåˆ¶åˆ›æ–°åè®® âœ… æ–°å¢
   â”œâ”€â”€ æ­¥éª¤1ï¼šä¸»é¢˜é€‰æ‹©ï¼ˆçƒ­é—¨+æ–°å…´+è·¨ç•Œï¼‰
   â”œâ”€â”€ æ­¥éª¤2ï¼šç»„åˆåˆ›æ–°æ£€æŸ¥æ¸…å•ï¼ˆ5ä¸ªé—®é¢˜ï¼‰
   â”œâ”€â”€ æ­¥éª¤3ï¼šå·®å¼‚åŒ–éªŒè¯ï¼ˆåˆ›æ–°ç‚¹ã€å·®å¼‚åŒ–ã€é£é™©ç­‰çº§ï¼‰
   â””â”€â”€ æ­¥éª¤4ï¼šå®æ—¶çƒ­ç‚¹èåˆï¼ˆäººè®¾ã€èƒŒæ™¯ã€å†²çªï¼‰

6. ğŸ”„ å˜åŒ–è¦æ±‚ï¼ˆé‡æ–°ç”Ÿæˆæ—¶ï¼‰
   â””â”€â”€ 5æ¡å˜åŒ–è§„åˆ™ + é¿å…é‡å¤æ£€æŸ¥æ¸…å•

7. ä»»åŠ¡åè®®
   â”œâ”€â”€ åè®®ä¸€ï¼šè·¨é¢˜æèåˆåˆ›æ–°çŸ©é˜µ
   â”‚   â”œâ”€â”€ æ–¹æ¡ˆA: çˆ½æ„Ÿèåˆå‹ï¼ˆå¤ä»‡+?ï¼‰
   â”‚   â”œâ”€â”€ æ–¹æ¡ˆB: è„‘æ´èåˆå‹ï¼ˆç©¿è¶Š+?ï¼‰
   â”‚   â””â”€â”€ æ–¹æ¡ˆC: æƒ…æ„Ÿèåˆå‹ï¼ˆç”œå® +?ï¼‰
   â”‚
   â””â”€â”€ åè®®äºŒï¼šæ–¹æ¡ˆç¼åˆï¼ˆå¦‚æœæœ‰èåˆè¯·æ±‚ï¼‰

8. Output Format (è¾“å‡ºæ ¼å¼)
   â”œâ”€â”€ æ¯ä¸ªæ–¹æ¡ˆçš„å®Œæ•´ç»“æ„
   â”‚   â”œâ”€â”€ ä¸€å¥è¯æ¢—æ¦‚
   â”‚   â”œâ”€â”€ ä¸»è§’äººè®¾ï¼ˆç”·ä¸»/å¥³ä¸»ï¼‰
   â”‚   â”œâ”€â”€ ä¸€å¥è¯å–ç‚¹
   â”‚   â”œâ”€â”€ å¼€ç¯‡è§†è§‰é’©å­
   â”‚   â”œâ”€â”€ æ ¸å¿ƒå›°å¢ƒ
   â”‚   â”œâ”€â”€ æ ¸å¿ƒçˆ½ç‚¹
   â”‚   â”œâ”€â”€ ä»˜è´¹å¡ç‚¹è®¾è®¡
   â”‚   â”œâ”€â”€ åå¥—è·¯è®¾è®¡
   â”‚   â””â”€â”€ **å¸‚åœºçƒ­ç‚¹å…ƒç´ ä½¿ç”¨å£°æ˜** âœ… æ–°å¢ï¼ˆå¿…å¡«ï¼‰
   â”‚
   â”œâ”€â”€ æ–¹æ¡ˆå¯¹æ¯”ä¸€è§ˆè¡¨
   â””â”€â”€ å‰ç«¯äº¤äº’æ•°æ®ï¼ˆJSONï¼‰


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         å…³é”®åˆ›æ–°ç‚¹æ€»ç»“                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

âœ… å·²å®ç°çš„ä¼˜åŒ–:

1. ä¸»é¢˜åº“æ‰©å±•
   - 5ä¸ª â†’ 13ä¸ªä¸»é¢˜
   - å…¨éƒ¨ä¸»é¢˜æœ‰å®Œæ•´çš„ core_formula, keywords, audience_analysis
   - åŠ¨æ€åŠ è½½ï¼Œéšæœºé€‰æ‹©5-8ä¸ªè¯¦ç»†å±•ç¤º

2. Prompté‡æ„
   - âŒ åˆ é™¤äº†å›ºå®šçš„5ä¸ª"çƒ­é—¨èåˆå…¬å¼"
   - âœ… æ·»åŠ äº†"è·¨é¢˜æèåˆåˆ›æ–°æŒ‡å—"ï¼ˆåˆ›æ–°åŸåˆ™+ç¦æ­¢ç»„åˆ+é¼“åŠ±ç»„åˆï¼‰
   - âœ… æ·»åŠ äº†"æ•°æ®åè§è­¦å‘Š"
   - âœ… æ·»åŠ äº†"å¼ºåˆ¶åˆ›æ–°åè®®"ï¼ˆ4æ­¥éª¤æ£€æŸ¥æ¸…å•ï¼‰
   - âœ… è¾“å‡ºæ ¼å¼è¦æ±‚"å¸‚åœºçƒ­ç‚¹å…ƒç´ ä½¿ç”¨å£°æ˜"

3. å¸‚åœºåˆ†æå¢å¼º
   - âœ… _extract_hot_elements() æå–6ç±»çƒ­ç‚¹æ•°æ®
   - âœ… åŒ…æ‹¬ emerging_combinationsï¼ˆæ–°å…´ç»„åˆï¼‰
   - âœ… åŒ…æ‹¬ overused_tropesï¼ˆè¿‡åº¦ä½¿ç”¨å¥—è·¯ï¼‰
   - âœ… ç¼“å­˜å‘¨æœŸä»7å¤©ç¼©çŸ­åˆ°1å¤©
   - âœ… _format_market_report() ä»¥"åˆ›æ„å»ºè®®"å½¢å¼è½¯æ€§å¼•å¯¼

4. å»é‡æœºåˆ¶
   - âœ… PlanDeduplicationService å®Œæ•´å®ç°
   - âœ… ç›¸ä¼¼åº¦è®¡ç®—ç®—æ³•ï¼ˆJaccard + åŠ æƒï¼‰
   - âœ… æ•°æ®åº“å­˜å‚¨ï¼ˆgenerated_plans_history è¡¨ï¼‰
   - âœ… ç”¨æˆ·åå¥½å­¦ä¹ ï¼ˆuser_plan_preferences è¡¨ï¼‰
   - âœ… é‡æ–°ç”Ÿæˆæ—¶è‡ªåŠ¨æ³¨å…¥å»é‡ä¸Šä¸‹æ–‡
   - âœ… æ•°æ®åº“è¿ç§»å·²æ‰§è¡Œï¼ˆ009_generated_plans_history.sqlï¼‰

5. æ•°æ®åº“æ“ä½œ
   - âœ… get_all_themes() - è·å–æ‰€æœ‰ä¸»é¢˜
   - âœ… get_recent_plans() - è·å–å†å²æ–¹æ¡ˆ
   - âœ… save_plan_history() - ä¿å­˜æ–¹æ¡ˆå†å²
   - âœ… get_user_plan_preferences() - è·å–ç”¨æˆ·åå¥½
   - âœ… update_user_plan_preferences() - æ›´æ–°ç”¨æˆ·åå¥½


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         æµç¨‹è¦†ç›–åº¦æ£€æŸ¥                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

| åŠŸèƒ½æ¨¡å— | å®ç°çŠ¶æ€ | è´¨é‡è¯„çº§ | å¤‡æ³¨ |
|---------|---------|---------|------|
| ä¸»é¢˜åº“åŠ¨æ€åŠ è½½ | âœ… å®Œæˆ | â­â­â­â­â­ | 13ä¸ªä¸»é¢˜ï¼Œéšæœºé€‰æ‹©ï¼Œæ˜¾ç¤ºå…¨éƒ¨åˆ—è¡¨ |
| å¸‚åœºåˆ†ææŠ¥å‘Šæ³¨å…¥ | âœ… å®Œæˆ | â­â­â­â­â­ | çƒ­ç‚¹å…ƒç´ æå–ï¼Œè½¯æ€§å¼•å¯¼ |
| Promptåˆ›æ–°åè®® | âœ… å®Œæˆ | â­â­â­â­â­ | 4æ­¥éª¤æ£€æŸ¥ï¼Œå¼ºåˆ¶åˆ›æ–° |
| æ•°æ®åè§è­¦å‘Š | âœ… å®Œæˆ | â­â­â­â­â­ | é™ä½é“¶å‘/é‡ç”Ÿæ¦‚ç‡æé†’ |
| å»é‡æœºåˆ¶ | âœ… å®Œæˆ | â­â­â­â­â­ | ç›¸ä¼¼åº¦è®¡ç®—ï¼Œå†å²è¿½è¸ª |
| çƒ­ç‚¹å…ƒç´ å¼ºåˆ¶å£°æ˜ | âœ… å®Œæˆ | â­â­â­â­â­ | è¾“å‡ºæ ¼å¼è¦æ±‚ |
| æ•°æ®åº“è¿ç§» | âœ… å®Œæˆ | â­â­â­â­â­ | 009å·è¿ç§»å·²æ‰§è¡Œ |
| Fallbackæœºåˆ¶ | âœ… å®Œæˆ | â­â­â­â­â­ | å¤šå¤„try-exceptä¿æŠ¤ |
| æ—¥å¿—è®°å½• | âœ… å®Œæˆ | â­â­â­â­â­ | structlogå…¨ç¨‹è®°å½• |

**æ€»ä½“è¦†ç›–åº¦: 100%** âœ…

æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½æ¨¡å—å‡å·²å®ç°å¹¶ç»è¿‡éªŒè¯ï¼
