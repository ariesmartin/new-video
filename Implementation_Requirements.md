# 全流程重构需求文档：爆款短剧生成逻辑 V2.0

本文档整理了针对 AI 短剧生成引擎的重构需求，旨在将系统从“死板分类”升级为“高概念爆款生成器”。

## 1. 核心设计理念 (Core Philosophy)
*   **从“死板分类”转向“场景引导”**：废除传统的“逆袭/甜宠/复仇”二级细分，改为“现代/古装/科幻”等大场景背景引导。
*   **高概念融合 (High Concept Fusion)**：不限制 AI 的选题方向，而是通过 Prompt 强制 AI 进行“反差元素”的融合（如：18岁太奶奶）。
*   **爆款公式化 (Viral Formula)**：引入“张力模型”和“爆款三维矩阵”，确保生成的三个方案分别对应“极致爽感”、“极致脑洞”和“极致情感”。

---

## 2. 模块一：Market Analyst (市场分析师)

### 2.1 代码层修改 (`backend/graph/nodes/market_analyst.py`)

#### A. 赛道定义 (`GENRE_DEFINITIONS`) 重构
废除旧的基于剧情类型的 Key（revenge, romance），采用基于时空背景的新 Key：

```python
GENRE_DEFINITIONS = {
    "modern": {
        "label": "🏙️ 现代都市",
        "desc": "豪门 / 职场 / 校园 / 家庭 / 悬疑",
    },
    "ancient": {
        "label": "👘 古装仙侠",
        "desc": "宫廷 / 江湖 / 修仙 / 穿越 / 玄幻",
    },
    "republic": {
        "label": "🎩 民国传奇",
        "desc": "军阀 / 谍战 / 宅门 / 梨园",
    },
    "future": {
        "label": "🤖 未来科幻",
        "desc": "末世 / 赛博 / 星际 / 异能 / 无限流",
    },
}
```

#### B. 交互逻辑简化 (Phase 2 Removal)
*   **移除**: Level 1.5 的二级细分选择（即选了赛道后不再弹出一堆子标签）。
*   **新增**: 用户点击大类（如“现代都市”）后，直接进入以下状态：
    *   Title: “场景已定：现代都市”
    *   Buttons:
        1.  `✨ AI 自动选题` (Action: `proceed_to_planning`): 跳过配置，直接让 AI 发挥。
        2.  `✍️ 自定义脑洞` (UI Guide): 提示用户在输入框输入具体想法（如“18岁太奶奶”）。
        3.  `🔙 重选背景`: 返回上一步。

### 2.2 Prompt 层修改 (`prompts/1_Market_Analyst.md`)

#### A. 逻辑解绑
*   **移除**: “违和感警告”（如“现实主义不能有霸总”）。
*   **新增**: “高概念鼓励”。
    *   规则 1: **反差优先**。如果监测到“身份错位”、“时空对撞”，判定为高潜力。
    *   规则 2: **打破刻板印象**。鼓励现实主义与霸总/奇幻元素的融合。

#### B. 输出策略
*   **场景 B (自由选题)**: 分析该背景下的“高概念趋势”，不要生成平庸题材。
*   **场景 C (深度分析)**: 针对用户输入的具体脑洞（如“太奶”），重点分析其 **反差萌点 (Strengths)** 和 **执行难点 (Weaknesses)**。

---

## 3. 模块二：Story Planner (故事策划师)

### 3.1 Prompt 层修改 (`prompts/2_Story_Planner.md`)

#### A. Protocol A: 爆款三维矩阵 (The Viral Matrix)
强制 AI 在没有明确要求时，必须生成三个互斥维度的方案：

1.  **方案 A: The Dopamine Hit (极致爽感型)**
    *   核心: **Identity Gap (身份降维)**。
    *   元素: 隐藏身份、扮猪吃虎、掉马打脸。
    *   Target: 下沉市场、泛用户。

2.  **方案 B: The High Concept (极致脑洞型)**
    *   核心: **Concept Clash (设定违和)**。
    *   元素: 极端环境 + 违和行为（如：太奶变少女，丧尸送外卖）。
    *   Target: 年轻用户、短视频用户。

3.  **方案 C: The Emotional Hook (极致情感型)**
    *   核心: **Emotional Dilemma (情感困境)**。
    *   元素: 宿命、不可调和的对立（爱vs恨）、极致拉扯。
    *   Target: 女性用户、情感需求用户。

#### B. 张力模型 (The Tension Model)
取代原有的“全局身份反差检查”，改为针对性检查：

*   **Check for Plan A**: 必须有 **身份反差** (外表vs实力)。
*   **Check for Plan B**: 必须有 **设定反差** (环境vs行为)。
*   **Check for Plan C**: 必须有 **情感两难** (爱vs恨/责任)。
    *   *修正*: 允许“总裁就是总裁”，只要他面临钱解决不了的情感痛苦。

#### C. 爆款节奏锁 (Viral-Pacing Protocol)
强制规定开篇前 30 秒的钩子类型：
*   **Modern**: 极羞辱开局（反击倒计时）。
*   **Ancient**: 生死一线（行刑/灭门）。
*   **Future**: 视觉奇观（违理画面）。

### 3.2 交互层更新
前端按钮展示需要配合新的矩阵：

```json
{
  "options": [
    { "tagline": "🔥 极致爽感 (Dopamine Hit)", ... },
    { "tagline": "🧠 极致脑洞 (High Concept)", ... },
    { "tagline": "💕 极致情感 (Emotional)", ... }
  ],
  "fusion_hint": "💡 想要神作？尝试融合 [A的爽感] + [B的脑洞] ！"
}
```

---

## 4. 总结
这一套重构方案旨在解决“AI 生成内容太正确但太无聊”的问题。通过**放宽入口限制**（允许乱炖）和**收紧生成逻辑**（强制爆款公式），让系统具备生成现象级爆款（如《十八岁太奶》）的能力。
