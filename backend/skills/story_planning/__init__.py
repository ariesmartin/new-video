"""
Story Planning Skills

故事规划相关的 Skills
"""

from typing import List
from langchain.tools import tool


@tool
def generate_plot_twist(base_idea: str) -> str:
    """Skill: 基于基础创意生成情节反转"""
    return f"""## 情节反转方案

基于创意：{base_idea}

### 反转 1: 身份反转
- **设置**: 主角表面身份 vs 真实身份
- **揭露时机**: 第10-15集
- **效果**: 震撼度 95分

### 反转 2: 关系反转
- **设置**: 仇人变亲人 / 恩人变仇人
- **揭露时机**: 第20-25集
- **效果**: 震撼度 90分

### 反转 3: 时空反转
- **设置**: 重生 / 穿越 / 梦境
- **揭露时机**: 第30-35集
- **效果**: 震撼度 88分

### 使用建议
选择 1-2 个反转即可，过多会显得牵强。
"""


@tool
def design_characters(genre: str, tone: str) -> str:
    """Skill: 设计人设"""
    return f"""## 人设设计方案

题材：{genre} | 调性：{tone}

### 主角
- **人设定位**: 成长型主角
- **核心特质**: 坚韧、机智、有正义感
- **成长弧线**: 从弱小到强大

### 反派
- **人设定位**: 立体型反派
- **动机**: 有合理的动机，不是纯粹的恶
- **与主角关系**: 亦敌亦友

### 配角群像
- **盟友**: 2-3个，各有特色
- **工具人**: 推动剧情发展
- **搞笑担当**: 缓解紧张气氛

### CP 组合
- **主 CP**: 主角 × 女主/男主
- **副 CP**: 配角 CP，增加甜度
"""


@tool
def create_outline(story_concept: str, episodes: int) -> str:
    """Skill: 创建分集大纲"""
    return f"""## 分集大纲（{episodes}集）

故事概念：{story_concept}

### 第一幕（第1-{episodes // 3}集）：铺垫
- **核心任务**: 建立世界观、介绍主角、抛出核心冲突
- **钩子**: 前3秒必须有强钩子
- **节奏**: 快节奏，快速进入主线

### 第二幕（第{episodes // 3 + 1}-{episodes * 2 // 3}集）：升级
- **核心任务**: 冲突升级、关系发展、伏笔铺设
- **爽点**: 每3集一个小高潮
- **节奏**: 快慢交替，保持张力

### 第三幕（第{episodes * 2 // 3 + 1}-{episodes}集）：高潮
- **核心任务**: 矛盾总爆发、身份揭露、问题解决
- **高潮**: 连续高能，情绪爆发
- **结局**: 圆满收束，留有余韵

### 卡点设计
- **付费卡点**: 每10集一个
- **悬念卡点**: 每3集一个
- **情绪卡点**: 每集结尾
"""


@tool
def load_theme_formula(genre_id: str) -> str:
    """Skill: 加载题材公式"""
    formulas = {
        "revenge": "极端羞辱 → 隐藏身份 → 身份揭露 → 打脸复仇",
        "sweet": "初遇误会 → 甜蜜相处 → 外界阻碍 → 终成眷属",
        "suspense": "谜团出现 → 调查深入 → 真相揭露 → 正义伸张",
    }

    formula = formulas.get(genre_id, "通用公式")

    return f"""## {genre_id} 题材核心公式

{formula}

### 公式解析
1. **第一幕**: 建立冲突，设置悬念
2. **第二幕**: 冲突升级，关系发展
3. **第三幕**: 高潮爆发，问题解决

### 使用建议
在公式基础上添加创新元素，避免完全照搬。
"""
