# 🌡️ AI 模型温度（Temperature）配置指南

## 什么是 Temperature？

Temperature 是控制 AI 模型输出随机性的参数：
- **低温度（0.1-0.5）**：保守、确定性强、可预测
- **中温度（0.6-0.8）**：平衡、适中创意
- **高温度（0.9-1.2）**：发散、创意性强、多样化

## 各任务类型的推荐温度

### 🎨 创意类任务（高温度）

| 任务 | 推荐温度 | 说明 |
|------|---------|------|
| **Story Planner（选题策划）** | **0.90** | 跨题材融合需要最高发散性，Backend已自动设置 |
| **Skeleton Builder（大纲构建）** | **0.88** | 剧情大纲设计需要高创意性设计转折和钩子，Backend已自动设置 |
| **Novel Writer（小说写作）** | **0.85** | 章节内容创作需要创意但也要保持连贯性，Backend已自动设置 |
| **重新生成方案** | **0.90 - 0.95** | 确保与上次明显不同，需要更高发散性 |
| **Market Analyst** | **0.80** | 市场分析需要基于数据但也要洞察趋势，Backend已自动设置 |

### 🔧 执行类任务（中低温度）

| 任务 | 推荐温度 | 说明 |
|------|---------|------|
| **Script Adapter** | 0.70 - 0.80 | 剧本改编需要创意但保持连贯性 |
| **Script Formatter** | 0.30 - 0.50 | 格式化需要确定性和准确性 |
| **Refiner（优化器）** | 0.60 - 0.75 | 优化需要在保持原意基础上改进 |

### 📊 分析类任务（低温度）

| 任务 | 推荐温度 | 说明 |
|------|---------|------|
| **Analysis Lab** | 0.30 - 0.50 | 分析需要准确性和一致性 |
| **Editor（编辑）** | 0.40 - 0.60 | 编辑需要准确判断 |
| **Asset Inspector** | 0.30 - 0.50 | 资产检查需要准确性 |

## 如何配置 Temperature

### 方法 1：通过 Web UI 配置

1. 进入 **设置 → LLM 服务商 → 模型映射**
2. 选择要配置的任务类型（如 `story_planner`）
3. 在 **Parameters** 字段中设置：
   ```json
   {
     "temperature": 0.9,
     "max_tokens": 4096
   }
   ```

### 方法 2：通过数据库直接修改

```sql
-- 更新 Story Planner 的温度设置
UPDATE model_mappings 
SET parameters = '{"temperature": 0.9, "max_tokens": 4096}'
WHERE task_type = 'story_planner';
```

## 针对跨题材融合的特殊建议

### 当前系统优化

我们已经对系统进行了以下温度相关优化：

1. **Prompt 中明确要求跨题材融合**
   - 强制每个方案必须融合 2-3 个题材
   - 提供 10 种黄金组合公式供参考

2. **重新生成时增加随机性参数**
   - `variation_seed`: 确保每次生成不同
   - `cross_theme_hint`: 明确指定跨主题组合

3. **背景适配过滤**
   - 根据背景自动过滤违和的组合
   - 但不限制题材选择的自由度

### 温度与创意的关系

```
温度 0.7: 复仇+甜宠 → "霸总复仇过程中遇到真爱"
温度 0.9: 复仇+甜宠 → "霸总在复仇中发现仇人之女竟是自己的救命恩人，陷入爱憎两难的境地"

温度 0.7: 悬疑+甜宠 → "侦探在破案时爱上嫌疑人"
温度 0.9: 悬疑+甜宠 → "侦探发现嫌疑人其实是自己失忆前的未婚妻，每个线索都指向两人的过去"
```

**结论**：对于跨题材融合，**temperature=0.9** 能产生更有创意和张力的组合。

## 调试建议

### 如果生成的方案太保守
- 将 temperature 从 0.7 提升到 0.9
- 检查 Prompt 是否限制了创意

### 如果生成的方案太随机
- 将 temperature 从 0.9 降低到 0.8
- 检查是否缺少背景约束

### 如果重新生成还是相似
- 确保 `is_regenerate=True` 时 temperature ≥ 0.9
- 检查 `variation_seed` 是否正确传递
- 确认 `fusion_combinations` 包含多样化组合

## 推荐配置模板

### 标准配置（推荐）
```json
{
  "story_planner": {
    "temperature": 0.9,
    "max_tokens": 4096
  },
  "script_adapter": {
    "temperature": 0.75,
    "max_tokens": 8192
  },
  "analysis_lab": {
    "temperature": 0.4,
    "max_tokens": 2048
  }
}
```

### 高创意配置（适合头脑风暴）
```json
{
  "story_planner": {
    "temperature": 0.95,
    "max_tokens": 4096
  }
}
```

### 保守配置（适合精准控制）
```json
{
  "story_planner": {
    "temperature": 0.8,
    "max_tokens": 4096
  }
}
```

## 注意事项

1. **不同模型对温度的敏感度不同**
   - GPT-4: 温度 0.9 效果很好
   - Claude: 温度 0.85 已经足够发散
   - Gemini: 温度可以稍高，0.9-0.95

2. **温度不是越高越好**
   - 超过 1.0 可能产生逻辑混乱
   - 跨题材融合需要在创意和合理之间平衡

3. **配合其他参数**
   - `max_tokens`: 确保足够生成长内容
   - `top_p`: 可以与 temperature 配合使用（通常保持默认 1.0）

## 总结

| 场景 | 推荐 Temperature |
|------|-----------------|
| 首次生成方案 | **0.85 - 0.90** |
| 重新生成方案 | **0.90 - 0.95** |
| 剧本改编 | 0.75 - 0.80 |
| 分析评估 | 0.30 - 0.50 |

**对于当前的跨题材融合系统，强烈建议将 Story Planner 的 temperature 设置为 0.9，以获得最佳的创意发散效果！**
